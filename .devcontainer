{
    "name": "Philosophy RAG",
    "build": {"dockerfile": "../Dockerfile"},
    "dockerComposeFile": "../docker-compose.yaml",
    "service": "notebook",
    "workspaceFolder": "/workspaces/app",
    
    "forwardPorts": [
        8888,  // Jupyter Notebook
        3000   // Grafana
    ],
    
    "customizations": {
        "vscode": {
            "extensions": [
                "ms-python.python",
                "ms-toolsai.jupyter",
                "grafana.grafana" 
            ],
            "settings": {
                "python.defaultInterpreterPath": "/usr/local/bin/python"
            }
        }
    },
    
    "remoteEnv": {
        "ELASTIC_HOST": "${localEnv:ELASTIC_HOST}",
        "ELASTIC_PORT": "${localEnv:ELASTIC_PORT}",
        "ELASTIC_API_KEY": "${localEnv:ELASTIC_API_KEY}",
        "GROQ_API_KEY": "${localEnv:GROQ_API_KEY}",
        "GRAFANA_PASSWORD": "${localEnv:GRAFANA_PASSWORD}",
        "GRAFANA_ROOT_URL": "${localEnv:GRAFANA_ROOT_URL}"
    },

    "postCreateCommand": "pip3 install --user -r requirements.txt",
    
    // Добавляем проверку готовности сервисов
    "postStartCommand": "while ! curl -s http://grafana:3000 > /dev/null; do sleep 1; done",
    
    // Добавляем информацию для пользователя
    "postAttachCommand": {
        "server-info": [
            "echo",
            "Jupyter is running on http://localhost:8888",
            "&&",
            "echo",
            "Grafana is running on http://localhost:3000 (default login: admin, password: admin)"
        ]
    },
    
    "remoteUser": "root",
    
    // Добавляем метки для лучшей интеграции с GitHub Codespaces
    "features": {
        "ghcr.io/devcontainers/features/common-utils:2": {
            "installZsh": "true",
            "username": "vscode",
            "upgradePackages": "true"
        }
    },
    "ghcr.io/schlich/devcontainer-features/grafana:1": {},
    "ghcr.io/devcontainers/features/docker-in-docker:2": {},
}